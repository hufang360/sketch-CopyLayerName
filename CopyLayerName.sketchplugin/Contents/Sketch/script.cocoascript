          var onRun = function(context) {
          var sketch = require('sketch')
var UI = require('sketch/ui')

var document = sketch.getSelectedDocument()

// æ‰¾å‡ºå½“å‰é€‰ä¸­çš„é¡µé¢
var pages = document.pages
var selectedIndex = -1
for (var i = 0; i < pages.length; i++) {
  if (pages[i].selected) {
    selectedIndex = i
    break
  }
}
if (selectedIndex == -1) {
  UI.message('æ²¡æœ‰é€‰ä¸­ä»»ä½•é¡µé¢!')
  return
}

// å¼€å§‹æŸ¥æ‰¾
var layerCount = 0
var typeFilter = ['Group','Artboard','Slice']
var objArr = []
var newObjArr = []

var layersObj = pages[selectedIndex].layers
findAGroup(layersObj)

// æŸ¥æ‰¾ä¸€ä¸ªç»„ä¸‹é¢çš„ layer å¯¹è±¡
function findAGroup(layers, prefix = '', idPrefix='') {
  for (var i = 0; i < layers.length; i++) {
    layer = layers[i]

    idStr = layer['id']
    if (prefix != ''){
      layerName = prefix + "/" + layer.name
    }else{
      layerName = layer.name
    }
    
    
    if (idPrefix!='') {
      layerID = idPrefix + "__" + idStr
      parentID = idPrefix
    }else{
      layerID = idStr
      parentID = ''
    }
    objArr.push({
      'id':idStr,
      'parentID': parentID,
      'type': layer.type,
      'layerName': layerName,
      'layerRawName': layer.name,
      'selected':layer.selected
    })
    
    var findex = typeFilter.indexOf(layer.type)
    if (findex == -1) {
      // console.log(layer.type + "    " + layerName + "    " + layer.selected)
      layerCount += 1
    }
    // if (layerCount >= 15) {
    //   console.log(layer)
    // }
    if (hasOwnKey(layer, 'layers'))
      findAGroup(layer.layers, layerName, layerID)
  }
}

// è¾“å‡ºåç§°ä¿¡æ¯
var groupNames = []
var ids = []
var mID = 0
for(var i=0; i<objArr.length; i++){
  obj = objArr[i]

  lSID = obj['parentID']
  lType = obj['type']
  lName = obj['layerName']
  lRawName = obj['layerRawName']
  // lSelected = obj['selected']

  sArr = lName.split('/')
  if(sArr.length==2){

    // è¿‡æ»¤æŒ‡å®šç±»å‹çš„å¯¹è±¡
    var findex = typeFilter.indexOf(lType)
    if (findex != -1)
      continue
    
    // åŸºäº id è¿›è¡Œç¼–ç»„ï¼ˆ001 002ä½œä¸ºå‰ç¼€ï¼‰
    // n = sArr[0]
    n = lSID
    gIndex = groupNames.indexOf(n)
    if (gIndex==-1) {
      groupNames.push(n)
      if(ids.length){
        mID = ids[ids.length-1]
        mID += 1
      }else{
        mID = 1
      }
      ids.push(mID)
    } 
    else {
      mID = ids[gIndex]
      // console.log(ids)
    }
    newObjArr.push({
      'id':mID,
      'layerName': lRawName
    })
  }
}

// æ‹·è´åˆ°å‰ªè´´æ¿
if (objArr.length){
  finalClipStr = getLayername(objArr)
  copyToPasteboard(finalClipStr)
  UI.message('ğŸ˜Š'+layerCount + " ä¸ªå›¾å±‚åç§°å·²æ‹·è´ï¼Œè¯·ç²˜è´´åˆ° è¡¨æ ¼ ä¸­")
} else {
  UI.message("åœ¨å½“å‰é¡µé¢ï¼Œæ²¡æœ‰æ‰¾åˆ°å›¾å±‚ï¼")
}



//----------------------
// æ ¼å¼åŒ–è·å¾—çš„å›¾å±‚å
function getLayername(objArr){
  var nameStr = "å›¾å±‚åç§°\tå¯¹è±¡ç±»å‹\tæ˜¯å¦è¢«é€‰ä¸­"
  for(var i=0; i<objArr.length; i++){
    obj = objArr[i]
    lType = obj['type']
    lName = obj['layerName']
    lSelected = obj['selected']
    lType = transEn(lType)
    lSelected = transBoo(lSelected)
    nameStr += '\n' + lName + "\t" + lType + "\t" + lSelected
  }
  return nameStr
}

// è½¬æ¢åç§°
function transEn(enStr){
  var aa = ['Group','Artboard','Slice','Image']
  var bb = ['ç¼–ç»„',"ç”»æ¿","åˆ‡ç‰‡","å›¾åƒ"]
  var aIndex = aa.indexOf(enStr)
  if (aIndex==-1)
    return enStr
  else
    return bb[aIndex]
}
// æç¤º boolean
function transBoo(enBoo){
  if (enBoo)
    return 'æ˜¯'
  else
    return 'å¦'
}
//----------------------


// å…¬å…±æ–¹æ³• --------------------------------
function hasOwnKey(obj, keyName) {
  for (var key in obj) {
    if (key == keyName)
      return true
  }
  return false
}
function formatNumer(num){
  if (num<10)
    return "00" + num
  else if(num<100)
    return "0" + num
  else
    return '' + num
}
// æ‹·è´åˆ°å‰ªè´´æ¿
function copyToPasteboard(copyStr){
  var pb = NSPasteboard.generalPasteboard()
  pb.clearContents()
  pb.writeObjects([copyStr])
}
          };
          